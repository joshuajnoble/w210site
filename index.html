<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Modeling Eviction Relief Funding</title>
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta name="description" content="">
    <meta name="author" content="">

    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.js"></script>
    <script src="papaparse.min.js"></script>

    <!-- Le styles -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karla">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DM+Serif+Display">
    <style type="text/css">
      body {
        font-family: 'Karla', serif;
        padding-top: 60px;
        padding-bottom: 40px;
      }
      h1 {
        font-family: 'DM+Serif+Display';
      }

    /*map { position: absolute; top: 0; bottom: 0; width: 50%; }*/
    .map { overflow: visible; width: 600px; min-width: 600px; min-height: 600px;}

    #dallas_features {
      /*position: absolute;
      top: 0;*/
      right: 0;
      /*bottom: 0;*/
      /*overflow: auto;*/
      word-wrap: break-word;
      /*font-family: sans-serif;*/
      padding-left: 20px;
    }

    #houston_features {
      /*position: absolute;
      top: 0;*/
      right: 0;
      /*bottom: 0;*/
      /*overflow: auto;*/
      word-wrap: break-word;
      /*font-family: sans-serif;*/
      padding-left: 20px;
    }

    #features > span {
      font-weight: 400;
    }

    .map canvas {
      cursor: crosshair;
    }


    .wrapper {
      width:960px;
      margin:0 auto;
    }
    </style>

    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="bootstrap/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="bootstrap/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="bootstrap/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="bootstrap/ico/apple-touch-icon-57-precomposed.png">

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Modeling Eviction Relief Funding</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">Our Goal</a></li>
              <li><a href="#data">Data</a></li>
              <li><a href="#modeling">Modeling</a></li>
              <li><a href="#results">Results</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit">
        <div>
          <h2>BERKELEY MIDS CAPSTONE</h2>
        </div>
        <div  style="padding-top:20px;">
          <h1>Modeling Eviction Relief</h1>
        </div>
        <div style="padding-top:20px;">
          <h3>Young Koung Kim, Joshua Noble, Elaine Chang</h3>
        </div>
      </div>

      <!-- Example row of columns -->
      <div class="row" id="about">
        <div class="span12">
          <h2>Our Goal</h2>
           <p>Our goal is to create a model that uses the demographic and economic data at the census tract level in order to predict eviction rates within that census tract. This model can be used by housing advocates, drivers and designers of public policy, and emergency housing and shelter organizations to understand where need might be most acute and how much might be needed in order to forestall the predicted evictions for a given census tract. Our analysis relies on the records of eviction cases filed in civil courts across the United States, as well as data on eviction moratoria at the state, county, and municipal levels. Our project goal is to model and predict the number of eviction counts in Houston, Texas and Dallas, Texas by census tract.

           Using the model would require that a user provide the demographic data and historical eviction data for a census tract in order to generate a forecast. Our forecasts provide estimates with an average accuracy of 0.38 evictions for an eight week forecast. This means that if the model is provided the correct data, it should be able to predict the number of evictions that will occur in two months time in a given census tract to within 0.5 evictions.
           </p>
        </div>
      </div>

      <!-- Example row of columns -->
      <div class="row" id="data">
        <div class="span12">
          <h2>Our Data</h2>

          <p>Our eviction data was compiled from several sources. The <a href="https://evictionlab.org/">Eviction Lab at Princeton University</a> provided us with historical data for Dallas and Houston that ran from 2001 until 2018. For 2018 until November 2021, we collected data from Dallas County Court records and Harris County Court records and then combined that with the data from the Eviction Lab to give us a 10 year picture of the evictions in each census tract.
           </p>

           <p>For demographic data, we used the US Census Bureau’s American Community Survey. As of Fall 2021 neither the ACS 1-year nor 5-year estimates were available for 2020 or 2021, so we’re making use of data from 2010 to the end of 2019 in order to build our model. We believe that adding in collected data from 2020 paired with the associated demographic and economic data would lead to the same forecasting power.
           </p>

           <p>
            The American Community Surveys include several thousand variables that describe each census tract. We wanted to select characteristics with statistical power that would help us create the most accurate forecast when included with the historical eviction data for that tract. We selected this by using a panel regression to help us identify which demographic statistics are most important over our 10 year time-frame. The formula that we followed uses the following variables:

            <table class="table table-striped">
              <tr>
                  <th>ACS Code</th>
                  <th>Value</th>
                </tr>
                <tr>
                  <td>A03001_003</td>
                  <td>Total Population Black or African American</td>
                </tr>
                <tr>
                  <td>A06001_005</td>
                  <td>Average Gross Rent for Renter-Occupied Housing</td>
                </tr>
                <tr>
                  <td>A08002B_003</td>
                  <td>Households paying 30-50% of income in rent</td>
                </tr>
                <tr>
                  <td>A10039B_009</td>
                  <td>Households paying 50% or more of income in rent</td>
                </tr>
                <tr>
                  <td>B18002_002</td>
                  <td>Residents who moved within the same county in the last year</td>
                </tr>
                <tr>
                  <td>B18002_003</td>
                  <td>Households with no earnings reported in the last year</td>
                </tr>
                <tr>
                  <td>A10011_003</td>
                  <td>Household income of $20,000-$34,999 spending >30% of income on rent</td>
                </tr>
            </table>

            Our formula was the following:

            <pre>
              smoothed ~ A03001_003 + A06001_005 + A08002B_003 + A10039B_009 + B18002_003 + B18002_002 + A10011_003 + entity_effects
            </pre>

            When run as a Panel Regression this gave us an R-squared (Between) of 0.9592 an R-squared (Within) of 0.4564 and an R-squared (Overall) of 0.6482.

           </p>

        </div>
      </div>

      <!-- Example row of columns -->
      <div class="row" id="modeling">
        <div class="span12">
          <h2>Modeling Process</h2>
           <p>Our model is an ensemble approach which uses four underlying predictor models to generate forecasts for eviction rates and then an ensembling model to select which forecasting model should be selected to provide the forecast. Certain models do better with certain sorts of data than others so an ensemble approach made the most sense in order to use the strengths of each models while not being constrained by their weaknesses.
           </p>

           <p>The training data is used to train each forecasting model. The forecasting results and the information about each tract is then passed to an ensembling model which learns which models perform best for the different characteristics of each tract.
           </p>

           <img width="100%" src="ensembling-img.png"/>

           <p>In order to use the model, the historical evictions and demographics of the tract should be passed to the model, which would then be able to select the appropriate forecasting model and create the forecast.
           </p>
           
           <img width="100%" src="prediction-img.png"/>

        </div>
      </div>

      <!-- Example row of columns -->
      <div class="row" id="results">
        <div class="span12">
          <h2>Modeling Results</h2>
           <p>We trained our forecasting models on 70% of our data and then trained the ensembling model on 20% of our data, leaving 10% for testing. This 10% was 110 census tracts across Dallas and Houston. To view how each tract performed hover over a tract. The results on the right will update to show how our model performed in each tract.
           </p>

        </div>
      </div>

      <!-- Example row of columns -->
      <div class="row" id="dallas-results">
        <div class="span12" style="padding-bottom: 10px; padding-top: 10px;">
          <h2> Results on test tracts in Dallas County </h2>
          <p> This map shows the characteristics of test tracts in Dallas and how those performed using two metrics: Root Mean Squared Error (RMSE) and Mean Absolute Squared Error (MASE).</p>
        </div>
        <div class="span6">
          <div class="map" id="dallas_map"></div>
        </div>
        <div class="span6">
          <div id="dallas_features">

            <h3>Tract ID:  <span id="dal-geoid"></span></h3>

            <h3>Eviction Forecast For Tract</h3>

            <p>Actual Evictions in October, 2019: <span id="dal-end-evictions"></span></p>
            <p>Forecast Evictions in December, 2019: <span id="dal-forecast-evictions"></span></p>
            <p>Actual Evictions December, 2019: <span id="dal-actual-evictions"></span></p>
            <p>Average claim for tract: <span id="dal-average-claim"></span></p>
            <p>Total forecast claim amount: <span id="dal-forecast-claims"></span></p>

            <h3>Tract Demographics</h3>

            <p>Total Population Black or African American Alone: <span id="dal_A03001_003"></span></p>
            <p>Average Gross Rent for Renter-Occupied Housing Units: <span id="dal_A18005_001"></span></p>
            <p>Households paying 30-50% of income in rent: <span id="dal_B18002_002"></span></p>
            <p>Households paying 50% or more of income in rent: <span id="dal_B18002_003"></span></p>
            <p>Residents who moved within the same county in the last year: <span id="dal_A08002B_003"></span></p>
            <p>Households with no earnings reported in the last year: <span id="dal_A10011_003"></span></p>
            <p>Household income of $20,000-$34,999 spending >30% of income on rent: <span id="dal_A10039B_009"></span></p>

            <h3>Model Performance</h3>

            <p>Best MASE Model: <span id="dal-best-mase-model"></span></p>
            <p>Best MASE <span id="dal-best-mase"></span></p>
            <p>Average MASE: <span id="dal-average-mase"></span></p>
            <p>Best RMSE: <span id="dal-best-rmse"></span></p>
            <p>Average RMSE: <span id="dal-average-rmse"></span></p>

          </div>
        </div>
      </div>

      <!-- Example row of columns -->
      <div class="row" id="houston-results">
        <div class="span12" style="padding-bottom: 10px; padding-top: 10px;">
          <h2> Results on test tracts in Harris County </h2>
          <p> This map shows the characteristics of test tracts in Houston and how those performed using two metrics: Root Mean Squared Error (RMSE) and Mean Absolute Squared Error (MASE).</p>
        </div>
        <div class="span6">
          <div class="map" id="houston_map"></div>
        </div>
        <div class="span6">
          <div id="houston_features">

            <h3>Tract ID: <span id="hou-geoid"></span></h3>

            <h3>Eviction Forecast For Tract</h3>

            <p>Actual Evictions in October, 2019: <span id="hou-end-evictions"></span></p>
            <p>Forecast Evictions in December, 2019: <span id="hou-forecast-evictions"></span></p>
            <p>Actual Evictions December, 2019: <span id="hou-actual-evictions"></span></p>
            <p>Average claim for tract: <span id="hou-average-claim"></span></p>
            <p>Total forecast claim amount: <span id="hou-forecast-claims"></span></p>

            <h3>Tract Demographics</h3>

            <p>Total Population Black or African American Alone: <span id="hou_A03001_003"></span></p>
            <p>Average Gross Rent for Renter-Occupied Housing Units: <span id="hou_A18005_001"></span></p>
            <p>Households paying 30-50% of income in rent: <span id="hou_B18002_002"></span></p>
            <p>Households paying 50% or more of income in rent: <span id="hou_B18002_003"></span></p>
            <p>Residents who moved within the same county in the last year: <span id="hou_A08002B_003"></span></p>
            <p>Households with no earnings reported in the last year: <span id="hou_A10011_003"></span></p>
            <p>Household income of $20,000-$34,999 spending >30% of income on rent: <span id="hou_A10039B_009"></span></p>

            <h3>Model Performance</h3>

            <p>Best MASE Model: <span id="hou-best-mase-model"></span></p>
            <p>Best MASE <span id="hou-best-mase"></span></p>
            <p>Average MASE: <span id="hou-average-mase"></span></p>
            <p>Best RMSE: <span id="hou-best-rmse"></span></p>
            <p>Average RMSE: <span id="hou-average-rmse"></span></p>

          </div>
        </div>
      </div>



      </div>

      <hr>

      <footer>
        <p></p>
      </footer>

    </div> <!-- /container -->

    <script>


    var parseResults = null;
    var claimAmounts = null;

    Papa.parse("testing_data.csv", {
      download: true,
      header: true,
      delimiter: ',',
      complete: function(results) {
        parseResults = results;
      }
    });

    Papa.parse("mean_claim_by_geoid.csv", {
      download: true,
      header: true,
      delimiter: ',',
      complete: function(results) {
        claimAmounts = results;
      }
    });

    function findClaimsByTract(t) {
      for( c in claimAmounts.data ){
        if(claimAmounts.data[c].GEOID == t ) {
          return claimAmounts.data[c].claim;
        }
      }
    }

    mapboxgl.accessToken = 'pk.eyJ1Ijoiam9zaHVham5vYmxlYmVya2VsZXkiLCJhIjoiY2t3a3htbGoyMDdmMzJ1dW56c2Vmb2hnayJ9.NozspSickipOVFVsBlcPBw';
    const dallas_map = new mapboxgl.Map({
      container: 'dallas_map', // container ID
      style: 'mapbox://styles/joshuajnobleberkeley/ckwkxyp94010v14rxd9lk11jy', // style URL
      center: [-96.79, 32.77], // starting position [lng, lat]
      zoom: 10 // starting zoom
    });


    const houston_map = new mapboxgl.Map({
      container: 'houston_map', // container ID
      style: 'mapbox://styles/joshuajnobleberkeley/ckwkxyp94010v14rxd9lk11jy', // style URL
      center: [-95.36, 29.76], // starting position [lng, lat]
      zoom: 10 // starting zoom
    });

    var models = {1:"NBEATS", 2:"LSTM", 3:"GRU", 4:"BRNN" };

    dallas_map.on('mousemove', (event) => {
      const features = dallas_map.queryRenderedFeatures(event.point);
       
      // Limit the number of properties we're displaying for
      // legibility and performance
      const displayProperties = [
        'type',
        'properties',
        'id',
        'layer',
        'source',
        'sourceLayer',
        'state'
      ];
       
      const displayFeatures = features.map((feat) => {
        const displayFeat = {};
        displayProperties.forEach((prop) => {
          displayFeat[prop] = feat[prop];
        });
        return displayFeat;
      });

      var tractID = null;

      for( f in displayFeatures ) {
        if(displayFeatures[f].properties.GEOID != null) {
          tractID = displayFeatures[f].properties.GEOID;
        }
      }

      if(tractID == null) {
        return; // no GEOID, bail
      }

      for( p in parseResults.data ) {
        if(parseResults.data[p].GEOID == tractID) {

          document.getElementById('dal-geoid').innerHTML = tractID;

          document.getElementById('dal-average-claim').innerHTML = '$' + Math.round(findClaimsByTract(tractID));
          document.getElementById('dal-forecast-claims').innerHTML = '$' + Math.round(findClaimsByTract(tractID));

          // document.getElementById('features').innerHTML = JSON.stringify(displayFeatures,null,2);
          document.getElementById('dal_A03001_003').innerHTML = parseResults.data[p].SE_A03001_003;
          document.getElementById('dal_A18005_001').innerHTML = '$' + Math.round(parseResults.data[p].SE_A18005_001);
          document.getElementById('dal_B18002_002').innerHTML = parseResults.data[p].SE_B18002_002;
          document.getElementById('dal_B18002_003').innerHTML = parseResults.data[p].SE_B18002_003;
          document.getElementById('dal_A08002B_003').innerHTML = parseResults.data[p].SE_A08002B_003;
          document.getElementById('dal_A10011_003').innerHTML = parseResults.data[p].SE_A10011_003;
          document.getElementById('dal_A10039B_009').innerHTML = parseResults.data[p].SE_A10039B_009;

          document.getElementById('dal-best-mase-model').innerHTML =  models[parseResults.data[p].best_model_mase];
          document.getElementById('dal-best-mase').innerHTML = parseResults.data[p].best_mase;
          document.getElementById('dal-best-rmse').innerHTML = parseResults.data[p].best_rmse;
          document.getElementById('dal-average-mase').innerHTML = parseResults.data[p].average_mase
          document.getElementById('dal-average-rmse').innerHTML = parseResults.data[p].average_rmse

        }
      }
    });

    houston_map.on('mousemove', (event) => {
      const features = houston_map.queryRenderedFeatures(event.point);
       
      // Limit the number of properties we're displaying for
      // legibility and performance
      const displayProperties = [
        'type',
        'properties',
        'id',
        'layer',
        'source',
        'sourceLayer',
        'state'
      ];
       
      const displayFeatures = features.map((feat) => {
        const displayFeat = {};
        displayProperties.forEach((prop) => {
          displayFeat[prop] = feat[prop];
        });
        return displayFeat;
      });

      var tractID = null;

      for( f in displayFeatures ) {
        if(displayFeatures[f].properties.GEOID != null) {
          tractID = displayFeatures[f].properties.GEOID;
        }
      }

      if(tractID == null) {
        return; // no GEOID, bail
      }

      for( p in parseResults.data ) {
        if(parseResults.data[p].GEOID == tractID) {

          document.getElementById('hou-geoid').innerHTML = tractID;

          document.getElementById('hou-average-claim').innerHTML = '$' + Math.round(findClaimsByTract(tractID));
          document.getElementById('hou-forecast-claims').innerHTML = '$' + Math.round(findClaimsByTract(tractID));

          // document.getElementById('features').innerHTML = JSON.stringify(displayFeatures,null,2);
          document.getElementById('hou_A03001_003').innerHTML = parseResults.data[p].SE_A03001_003;
          document.getElementById('hou_A18005_001').innerHTML = '$' + Math.round(parseResults.data[p].SE_A18005_001);
          document.getElementById('hou_B18002_002').innerHTML = parseResults.data[p].SE_B18002_002;
          document.getElementById('hou_B18002_003').innerHTML = parseResults.data[p].SE_B18002_003;
          document.getElementById('hou_A08002B_003').innerHTML = parseResults.data[p].SE_A08002B_003;
          document.getElementById('hou_A10011_003').innerHTML = parseResults.data[p].SE_A10011_003;
          document.getElementById('hou_A10039B_009').innerHTML = parseResults.data[p].SE_A10039B_009;

          document.getElementById('hou-best-mase-model').innerHTML =  models[parseResults.data[p].best_model_mase];
          document.getElementById('hou-best-mase').innerHTML = parseResults.data[p].best_mase;
          document.getElementById('hou-best-rmse').innerHTML = parseResults.data[p].best_rmse;
          document.getElementById('hou-average-mase').innerHTML = parseResults.data[p].average_mase
          document.getElementById('hou-average-rmse').innerHTML = parseResults.data[p].average_rmse

        }
      }
    });


  </script>

  </body>
</html>
